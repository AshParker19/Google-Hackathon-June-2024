{% extends "base.html" %}

{% block title %}
Programa
{% endblock %}
{% block content %}

<div class="runs w-100 m-auto">
  <div class="w-100 m-auto p-0">
    <div class="w-100 row m-auto p-0">

      <div id="map_wrapper" class="w-50 p-0">
        <div id="map" class="float-end border-0 m-auto" style="width: 600px"></div>
      </div>
      {% for card in cards_data %}
      <!-- Modal -->
      <div class="modal fade" id="modal-{{card.index}}">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
              <h4 class="modal-title">{{card.designacao}}</h4>
            </div>
            <!-- Modal Body -->
            <!-- Tabs -->
            <ul class="nav nav-tabs" id="myTab{{card.index}}" role="tablist">
              <li class="nav-item" role="presentation">
                <a class="nav-link active" id="predicted-data-tab{{card.index}}" data-bs-toggle="tab" href="#predicted-data{{card.index}}" role="tab" aria-controls="predicted-data{{card.index}}" aria-selected="true">Previsões</a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="historic-data-tab{{card.index}}" data-bs-toggle="tab" href="#historic-data{{card.index}}" role="tab" aria-controls="historic-data{{card.index}}" aria-selected="false">Dados históricos</a>
              </li>
              <li class="nav-item" role="presentation">
                <a class="nav-link" id="info-tab{{card.index}}" data-bs-toggle="tab" href="#info{{card.index}}" role="tab" aria-controls="info{{card.index}}" aria-selected="false">info</a>
              </li>
            </ul>
            <!-- Tab content -->
            <div class="tab-content" id="myTabContent{{card.index}}">
              <div class="tab-pane fade show active" id="predicted-data{{card.index}}" role="tabpanel" aria-labelledby="predicted-data-tab{{card.index}}">
                <div class="modal-body">
                  <div class="d-flex flex-column justify-content-around">
                    <div>
                      {{ graph_html[card.index][0] | safe }}
                    </div>
                    <div>
                      {{ graph_html[card.index][1] | safe }}
                    </div>
                    <div>
                      {{ graph_html[card.index][2] | safe }}
                    </div>
                    <div>
                      {{ graph_html[card.index][3] | safe }}
                    </div>
                    <div>
                      {{ graph_html[card.index][4] | safe }}
                    </div>
                    <div class="d-flex flex-column justify-content-around">
                      <div>
                        <h3>IA Insights</h3>
                        <div>
                          {{ data_analysis[card.designacao] | safe }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tab-pane fade" id="historic-data{{card.index}}" role="tabpanel" aria-labelledby="historic-data-tab{{card.index}}">
                <div class="tab-pane fade show active" id="predicted-data{{card.index}}" role="tabpanel" aria-labelledby="historic-data-tab{{card.index}}">
                  <div class="modal-body">
                    <div class="d-flex flex-column justify-content-around">
                      <div class="d-flex flex-column justify-content-around">
                        <div>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tab-pane fade" id="info{{card.index}}" role="tabpanel" aria-labelledby="info-tab{{card.index}}">Contact content...</div>
            </div>
            <!-- Modal Footer -->
            <div class="modal-footer">
              <button type="button" class="btn btn-dark px-3" data-dismiss="modal">Fechar</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
      <div class="w-50 m-auto col p-0">
        <h3 class="p-0 m-0 text-center">
        Previsões
        </h3>
        <div class="entries m-auto my-1 px-3 py-1 w-100">
          <div class="sort item w-100 title mx-auto py-0 w-100">
            <div class="w-100 title-cont py-0 d-flex flex-row align-items-center justify-content-between">
              <h6 class="py-0 text-left">Lisboa</h6>
              <h6 class="py-0 text-left">Ordem: Decrescente, Necessidade</h6>
              <h6 class="py-0 text-right">2024-2027</h6>
            </div>
          </div>
          <!-- Sort field -->
          <div class="sort text-center my-2">
            <label for="sortField">Sort by: </label>
            <select id="sortField" onchange="sortCards()">
              <option value="necessity_metric">Necessity Metric</option>
              <option value="designacao">Designation</option>
            </select>
          </div>
          <!-- Entries for each location -->
          {% for card in cards_data%}
          <div class="item py-3">
            <div class="d-flex flex-row">
              <div class="d-block p-0 mx-3 rounded-circle color-mark"></div>
            </div>
            <div class="row w-75 m-auto pl-2">
              <div class="col-7">
                <span>{{ card['designacao'] }}</span>
              </div>
              <div class="col-5">
                <span>Necessidade: {{ card['necessity_metric'] }}%</span>
              </div>
            </div>
            <!-- Modal Button  -->
            <button type="button" class="btn btn-primary w-25 rounded" data-id="{{card.index}}" data-toggle="modal" data-target="#modal-{{card.index}}">
                Detalhes
            </button>
            <input class="mx-3" type="radio" name="advance" onclick="enableAddPoints()">
          </div>
          {% endfor %}
        </div>
        <div class="w-100">
          <div class="d-flex flex-row d-flex flex-row justify-content-center mx-auto">
            <button id="add_button" type="button" class="rounded py-2 mx-1" onclick="pushToEditPage()">Adicionar
              pontos</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/map.js') }}"></script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_map_api_key }}&callback=initMap"></script>

<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    addExistingPoints();
  });

  function addExistingPoints() {
    const cords = [
      {
        lat: 38.73137703560319,
        lng: -9.144382789532516,
        title: 'Loja de Cidadão do Saldanha'
      },
      {
        lat: 38.750402670143856,
        lng: -9.17123563186069,
        title: 'Loja de Cidadão das Laranjeiras'
      }
    ];

    cords.forEach(cord => {
      addNewNonDraggabePoint({ lat: cord.lat, lng: cord.lng }, cord.title, true);
    });
  }


  pushToEditPage = () => {
    const selectedLocation = _.head(exisingPoints);
    const url = `/edit?lat=${selectedLocation.cordinates.lat}&lng=${selectedLocation.cordinates.lng}&title=${selectedLocation.title}`;
    window.location.href = url;
  }
</script>

{% endblock %}